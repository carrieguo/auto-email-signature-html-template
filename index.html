<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="bower_components/react/react.min.js"></script>
    <script src="bower_components/react/react-dom.min.js"></script>
    <script src="build/browser.min.js"></script>
    <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
<script id="blockOfStuff" language="">

</script>
<div id="wrapper" css="container"></div>
<script type="text/babel">
    function getCode(user){
        var officeSite = "";
        if(user.office == "Qingdao"){
            officeSite = "23D, Tower A, Kaixuan Building 43 Donghai West Road Shinan District Qingdao, Shandong China";
        }
        else if(user.office == "Sydney"){
            officeSite = "Level 1, 277 Clarence Street, Sydney NSW 2000, Australia";
        }
        else{
            officeSite = "580 Nanjing West Road, Shanghai, 20040, China";
        }
        var html = '<!DOCTYPE html><html><head><title>Think China Signature</title><meta charset="UTF-8"></head><body><br><table width="600" border="0" cellspacing="0" cellpadding="0" style="font-family: Helvetica Neue, Helvetica, Arial, sans-serif; font-size: 10pt; color:#333333;"><tr><td width="122" rowspan="2" style="border-right: 1px solid #333333;"><div class="company-logo"><a href="http://www.thinkchina.com.au/"><img src="http://www.thinkchina.com.au/email_signature/think-china-logo.jpg" width="122" height="90" border="0"></a><div></td><td width="8"></td><td colspan="2"><div class="name" style="font-weight:bold; font-size:11pt; color:#51b614">';
        html += user.enName+' '+user.cnName;
        html += '</div><div class="title" style="font-weight:bold;">System Administrator</div><div class="company-website-email"><a href="http://www.thinkchina.com.au" style="text-decoration:none;color:#2E2E2E;">THINK <strong>CHINA</strong></a> | <a href="mailto:';
        html += user.email;
        html += '" style="text-decoration:none;color:#2E2E2E;">';
        html += user.email;
        html += '</a></div></td></tr><tr><td width="8"></td><td><div class="contact-details">CN Tel: <a href="tel:+86053285622988" style="text-decoration:none;color:#2E2E2E;">0532 8562 2988</a> &nbsp; AU Tel: <a href="tel:+61290985087" style="text-decoration:none;color:#2E2E2E;">02 9098 5087</a></div><div class="address">';
        html += officeSite;
        html += '</div></td></tr><tr><td colspan="30" style="font-size:9pt;"><br><div class="banner"><img src="http://www.thinkchina.com.au/email_signature/think-china-banner.jpg" width="600" height="62" border="0"></div><div class="social-media">Follow our latest China digital marketing updates on <a style="text-decoration:underlined; color:#2E2E2E;" href="http://www.linkedin.com/company/think-china-digital-marketing-consulting">LinkedIn</a> and <a href="http://www.thinkchina.com.au/thinkblog" style="text-decoration:underlined; color:#2E2E2E;">www.thinkchina.com.au/thinkblog</a>.</div><div class="abn">Think China is a division of Cathay Digital Pty Ltd ABN 651 67 223 369.</div></td></tr></table></body></html>';
        return html;
    }
    // Function to download data to a file
    function download(data, filename, type) {
        var a = document.createElement("a"),
            file = new Blob([data], {type: type});
        if (window.navigator.msSaveOrOpenBlob) // IE10+
            window.navigator.msSaveOrOpenBlob(file, filename);
        else { // Others
            var url = URL.createObjectURL(file);
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            setTimeout(function() {
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
            }, 0);
        }
    }
    var MyForm = React.createClass({
        getInitialState: function () {
            return {
                email: "",
                emailError: "Required!",
                nameEnError: "Required!",
                nameCnError: "",
                titleError: "Required!",
                selectedOffice: "Sydney",
                disabled : true,
                code : "my code"
            };
        },
        handleOptionChange: function (changeEvent) {
            this.setState({
                selectedOffice: changeEvent.target.value
            });
        },
        handleNameEn: function (e) {
            var value = e.target.value;
            var error = "";
            if (value.length < 1) {
                error = "Required!";
            }
            else if((/.*[\u4e00-\u9fa5]+.*$/).test(value)){
                error = 'must be english';
            }
            this.setState({
                nameEn: value,
                nameEnError: error
            });
        },
        handleNameCn: function (e) {
            var value = e.target.value;
            var error = "";
            if ((value.length >0)&&(!((/.*[\u4e00-\u9fa5]+.*$/).test(value)))) {
                error = 'must be Chinese';
            }
            this.setState({
                nameCn: value,
                nameCnError: error
            });
        },
        handleTitle: function (e) {
            var value = e.target.value;
            var error = "";
            if (value.length <1) {
                error = 'Required!';
            }
            this.setState({
                nameCn: value,
                nameCnError: error
            });
        },
        handleEmail: function (e) {
            var value = e.target.value;
            var error = '';
            if (value.length < 1) {
                error = "Required!";
            }
            else if (!(/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(value))) {
                error = 'Email Address in invalid format!';
            }
            this.setState({
                email: value,
                emailError: error
            });
        },
        handleSubmit: function (e) {
            e.preventDefault();
            var user = {
                office: this.state.selectedOffice,
                enName: this.refs['myNameEn'].value,
                cnName: this.refs['myNameCn'].value,
                email: this.refs['myEmail'].value
            }
//            console.log('You have selected:', this.state.selectedOffice);
//            console.log(this.refs['myNameEn'].value);
//            console.log(this.refs['myNameCn'].value);
//            console.log(this.refs['myEmail'].value);

            this.setState({
                code: getCode(user)
            });
            console.log(this.state.code);


        },
        download(data, filename, type) {
            var a = document.createElement("a"),
                file = new Blob([data], {type: type});
            if (window.navigator.msSaveOrOpenBlob) // IE10+
                window.navigator.msSaveOrOpenBlob(file, filename);
            else { // Others
                var url = URL.createObjectURL(file);
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                setTimeout(function() {
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);
                }, 0);
            }
        },
        render: function () {
            return (
                <div>
                    <form onSubmit={this.handleSubmit}>
                        <p>
                            <label for="inputOffice" className="col-sm-2 control-label">Choose your office </label>
                            <div className="radio col-sm-10">
                                <label class="radio-inline">
                                    <input type="radio"
                                           value="Sydney" name="inlineRadioOptions"
                                           checked={this.state.selectedOffice === 'Sydney'}
                                           onChange={this.handleOptionChange} />
                                    Sydney
                                </label>
                                <label class="radio-inline">
                                    <input type="radio"
                                           value="Shanghai" name="inlineRadioOptions"
                                           checked={this.state.selectedOffice === 'Shanghai'}
                                           onChange={this.handleOptionChange} />
                                    Shanghai
                                </label>
                                <label class="radio-inline">
                                    <input type="radio"
                                           value="Qingdao" name="inlineRadioOptions"
                                           checked={this.state.selectedOffice === 'Qingdao'}
                                           onChange={this.handleOptionChange} />
                                    Qingdao
                                </label>
                            </div>
                        </p>
                        <p>
                            <label for="nameEn" className="col-sm-2 control-label">Name in English:</label>
                            <div classname="col-sm-10">
                                <input type='text' name='nameEn' id='nameEn' ref="myNameEn" value={this.state.nameEn}
                                       onChange={this.handleNameEn}/>
                                <span>{this.state.nameEnError}</span>
                            </div>
                        </p>
                        <p>
                            <label for="nameCn" className="col-sm-2 control-label">Name in Name in Chinese:</label>
                            <div classname="col-sm-10">
                                <input type='text' name='nameCn' id='nameCn' ref="myNameCn" value={this.state.nameCn}
                                       onChange={this.handleNameCn}/>
                                <span>{this.state.nameCnError}</span>
                            </div>
                        </p>
                        <p>
                            <label for="title" className="col-sm-2 control-label">Title</label>
                            <div classname="col-sm-10">
                                <input type='text' name='title' id='title' ref="myTitle" value={this.state.title}
                                       onChange={this.handleTitle}/>
                                <span>{this.state.titleError}</span>
                            </div>
                        </p>
                        <p>
                            <label for="email" className="col-sm-2 control-label">email:</label>
                            <div classname="col-sm-10">
                                <input type='text' name='email' id='email' ref="myEmail" value={this.state.email}
                                       onChange={this.handleEmail}/>
                                <span>{this.state.emailError}</span>
                            </div>
                        </p>
                        <button name="Disabled" disabled={(this.state.emailError)||(this.state.nameEnError)}>Submit</button>
                    </form>
                    <textarea className="form-control" rows="3" value={this.state.code}></textarea>
                    <span>click the button download the file</span>
                    <button onClick={() => this.download(this.state.code, 'myfile.txt', 'text/plain')}>Create file</button>
                </div>

            )
        }
    });
    ReactDOM.render(
            <MyForm />,
        document.getElementById("wrapper")
    );
</script>
</body>
</html>